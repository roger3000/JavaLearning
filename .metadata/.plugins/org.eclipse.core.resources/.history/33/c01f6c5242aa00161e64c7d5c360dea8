<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
        <%@ taglib prefix="ww" uri="/webwork" %>
<!doctype html>
<html class="no-js">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title><ww:property value='paramConfig.getStringValue("project_name")'/></title>
  <meta name="description" content="日志查询">
  <meta name="keywords" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <link rel="icon" type="image/png" href="<%=request.getContextPath() %>/mm/assets/i/favicon.png">
  <link rel="stylesheet" href="<%=request.getContextPath() %>/mm/assets/css/amazeui.min.css">
  <link rel="stylesheet" href="<%=request.getContextPath() %>/mm/assets/css/admin.css">
</head>
<body>

<ww:include value="mgttop.jsp"></ww:include>
<ww:include value="mgtback.jsp"></ww:include>

<div class="am-cf admin-main">

  <!-- content start -->
  <div class="admin-content am-input-sm">
 <form method="post" class="am-form-inline" action="<%=request.getContextPath() %>/mgt/logquery.xhtml" id="logForm">
      
 <div class="am-g am-u-sm-12">
	
	
	  <div class="am-form-group am-input-group-sm">
	  		<label>&nbsp;&nbsp;按手机号码：</label><input type="text" class="am-form-field" id="u_mobile" name="u_mobile" value="<ww:property value='u_mobile'/>" placeholder="请输入查询手机号" >
	  </div>
	  
	  <div class="am-form-group am-input-group-sm">
	        <label>&nbsp;&nbsp;按操作类型：</label>
	        	  <select id="u_type" name="u_type" class="am-form-group am-input-group-sm" data-am-selected="{maxHeight: 200, btnSize: 'sm', btnStyle: 'secondary'}">
	        	  		<option value="">请选择</option>
	        	  		<option value="0" <ww:if test='u_type.trim().equals("1")'>selected="selected"</ww:if>>查询</option>
	        	  		<option value="1" <ww:if test='u_type.trim().equals("2")'>selected="selected"</ww:if>>新增</option>
	        	  		<option value="2" <ww:if test='u_type.trim().equals("3")'>selected="selected"</ww:if>>修改</option>
	        	  		<option value="3" <ww:if test='u_type.trim().equals("4")'>selected="selected"</ww:if>>删除</option>			      
	        	  		</select>	        
	  </div>	  
	
	  <div class="am-form-group am-input-group-sm">
	        <label>&nbsp;&nbsp;日志类型：</label>
	        	  <select id="u_status" name="u_status" class="am-form-group am-input-group-sm" data-am-selected="{maxHeight: 200, btnSize: 'sm', btnStyle: 'secondary'}">
	        	  		<option value="">请选择</option>
	        	  		<option value="000" <ww:if test='u_status.trim().equals("000")'>selected="selected"</ww:if>>发送成功</option>
			      </select>
	  </div>

	  <div class="am-form-group am-input-group-sm">
	  	&nbsp;&nbsp;<input type="submit" name="" value="立即搜索" class="am-btn am-btn-default am-input-sm">
	  </div>
	  
	   <p>  
	
</div>      
      
      
    <div class="am-g">
      <div class="am-u-sm-12 am-scrollable-horizontal">
        <table class="am-table am-table-striped am-table-bordered am-table-compact am-text-nowrap" id="example">
          <thead>
          <tr>
          <ww:if test="#session['manage'].mRole!=null && (#session['manage'].mRole.indexOf('operator')>-1 ||#session['manage'].mRole.indexOf('risk')>-1 ||#session['manage'].mRole.indexOf('manage')>-1 ||#session['manage'].mRole.indexOf('finance')>-1 || #session['manage'].mRole.indexOf('admin')>-1 )">
            <th>操作</th>
          </ww:if> 
            <th>发送时间</th>
            <th>发送号码</th>
            <th>发送状态</th>
            <th>发送内容</th>
            <th>发送流水</th>
            <th>备注(元)</th>
          </tr>
          </thead>
          <tbody>
          
          <ww:iterator value='smsList'>
          <tr class="am-input-sm">
          <ww:if test="#session['manage'].mRole!=null && (#session['manage'].mRole.indexOf('operator')>-1 ||#session['manage'].mRole.indexOf('risk')>-1 ||#session['manage'].mRole.indexOf('manage')>-1 ||#session['manage'].mRole.indexOf('finance')>-1 || #session['manage'].mRole.indexOf('admin')>-1 )">
            <td>
              <div class="am-dropdown" data-am-dropdown>
                <button class="am-btn am-btn-default am-btn-xs am-dropdown-toggle" data-am-dropdown-toggle><span class="am-icon-cog"></span> <span class="am-icon-caret-down"></span></button>
                <ul class="am-dropdown-content">
                  <li><a href="#" onclick="dosms(<ww:property value='[0].mId'/>)">重发短信</a></li>
                </ul>
              </div>            
            </td> 
           </ww:if>          
          <td><ww:property value='[0].mDate'/></td>
          <td><ww:property value='[0].mSendTel'/></td>
          <ww:if test="[0].mStatus=='000'">
          		<td>发送成功</td>
          </ww:if>
          <ww:elseif test="[0].mStatus=='-01'">
          		<td>当前账号余额不足！</td>
          </ww:elseif>          
          <ww:elseif test="[0].mStatus=='-02'">
          		<td>当前用户ID错误！</td>
          </ww:elseif>
          <ww:elseif test="[0].mStatus=='-03'">
          		<td>当前密码错误！</td>
          </ww:elseif>          
          <ww:elseif test="[0].mStatus=='-04'">
          		<td>参数不够或参数内容的类型错误！</td>
          </ww:elseif>
          <ww:elseif test="[0].mStatus=='-05'">
          		<td>手机号码格式不对！</td>
          </ww:elseif>          
          <ww:elseif test="[0].mStatus=='-06'">
          		<td>短信内容编码不对！</td>
          </ww:elseif>
          <ww:elseif test="[0].mStatus=='-07'">
          		<td>短信内容含有敏感字符！</td>
          </ww:elseif>
          <ww:elseif test="[0].mStatus=='-08'">
          		<td>无接收数据</td>
          </ww:elseif>
          <ww:elseif test="[0].mStatus=='-09'">
          		<td>系统维护中</td>
          </ww:elseif>          
          <ww:elseif test="[0].mStatus=='-10'">
          		<td>手机号码数量超长！（100个/次 超100个请自行做循环）</td>
          </ww:elseif>
          <ww:elseif test="[0].mStatus=='-11'">
          		<td>短信内容超长！（70个字符）</td>
          </ww:elseif>          
          <ww:elseif test="[0].mStatus=='-12'">
          		<td>其它错误</td>
          </ww:elseif>
          <ww:else>
          		<td>异常</td>
          </ww:else>          
          <td><ww:property value='[0].mSendContent'/></td>
          <td><ww:property value='[0].mSeq'/></td>
          <td><ww:property value='[0].mNote'/></td>
          </tr>
		  </ww:iterator>

          </tbody>
        </table>
        
        
<ww:include value="mgtpage.jsp"></ww:include>
        
        
      </div>
    </div>
  
</form>  
<ww:include value="mgtbottom.jsp"></ww:include>
<ww:include value="msgtpl.jsp"></ww:include>

  </div>
  <!-- content end -->

</div>

<script src="<%=request.getContextPath() %>/mm/assets/js/jquery.min.js"></script>
<script src="<%=request.getContextPath() %>/mm/assets/js/amazeui.min.js"></script>
</body>
</html>


<script type="text/javascript">

function dosms(mId){
	$('#loading').modal();
    $.ajax( {  
	    url:'<%=request.getContextPath() %>/mgt/dosms.xhtml',
	    data:{'u_mId':mId},
	    type:'post',  
	    cache:false,  
	    dataType:'json',  
	    success:function(data) {
	    	$('#loading').modal('close');
	        if(data.success){
	        	$('#message').html(data.message);
	        	$('#alertMessage').modal();
	        }else{
	        	$('#message').html(data.message);
	        	$('#alertMessage').modal();
	        }  
	     },  
	     error : function() { 
    	    $('#loading').modal('close');
        	$('#message').html('系统异常');
        	$('#alertMessage').modal(); 
	     }  
	});
}

$(function(){	
	
	$('#alertMessage').on('closed.modal.amui', function() {
		  $(this).removeData('amui.modal');
	});
	
	var page = <ww:property value='page'/> ;
	var maxPage = <ww:property value='maxPage'/> ;
	var prev = page - 1 ;
	var next = page + 1 ;
	
	$('#first').on('click',function(){
		$('#page').attr("value",'1');
		$('#smsForm').submit();
	});
	$('#prev').on('click',function(){
		$('#page').attr("value",prev);
		$('#smsForm').submit();
	});
	$('#next').on('click',function(){
		$('#page').attr("value",next);
		$('#smsForm').submit();
	});
	$('#max').on('click',function(){
		$('#page').attr("value",<ww:property value='maxPage'/>);
		$('#smsForm').submit();
	});	
	  	
});
</script>